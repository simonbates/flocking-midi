/*
 * Flocking MIDI Demos: Ports View
 * http://github.com/colinbdclark/flocking-midi
 *
 * Copyright 2016, Colin Clark
 * Licensed under the MIT license.
 */

"use strict";

fluid.defaults("flock.midi.demos.portsView", {
    gradeNames: "fluid.viewComponent",

    modelListeners: {
        inputs: {
            excludeSource: "init",
            funcName: "flock.midi.demos.portsView.renderPorts",
            args: [
                "{that}.model.inputs",
                "{that}.dom.inputsHeader",
                "{that}.options.markup.port"
            ]
        },

        outputs: {
            excludeSource: "init",
            funcName: "flock.midi.demos.portsView.renderPorts",
            args: [
                "{that}.model.outputs",
                "{that}.dom.outputsHeader",
                "{that}.options.markup.port"
            ]
        }
    },

    markup: {
        table: "<table class='flc-midi-portsView'><tr><th>ID</th><th>Name</th><th>State</th><th>Status</th></tr></table>",
        inputs: "<tr class='flc-midi-portsView-inputs'><td colspan=4>%inputsTitle</td></tr>",
        outputs: "<tr class='flc-midi-portsView-outputs'><td colspan=4>%outputsTitle</td></tr>",
        port: "<tr id='%id' class=flc-midi-portsView-port><td>%id</td><td class='fl-midi-portsView-name'>%manufacturer %name</td><td>%state</td><td>%connection</td></tr>"
    },

    strings: {
        inputsTitle: "Inputs",
        outputsTitle: "Outputs"
    },

    selectors: {
        portsTable: ".flc-midi-portsView",
        inputsHeader: ".flc-midi-portsView-inputs",
        outputsHeader: ".flc-midi-portsView-outputs",
        ports: ".flc-midi-portsView-port"
    },

    listeners: {
        "onCreate.renderPortsTable": {
            funcName: "flock.midi.demos.portsView.renderPortsTable",
            args: ["{that}.container", "{that}.options"]
        }
    }
});

flock.midi.demos.portsView.renderTableHeader = function (type, table, options) {
    var rendered = fluid.stringTemplate(options.markup[type], options.strings);
    table.append(rendered);
};

flock.midi.demos.portsView.renderPortsTable = function (container, options) {
    var table = $(options.markup.table);

    flock.midi.demos.portsView.renderTableHeader("inputs", table, options);
    flock.midi.demos.portsView.renderTableHeader("outputs", table, options);
    container.append(table);
};

flock.midi.demos.portsView.renderPort = function (port, sectionHeader, portMarkup) {
    var rendered = fluid.stringTemplate(portMarkup, port);
    $("#" + port.id).remove(); // We need a renderer. :(

    sectionHeader.after(rendered);
};

flock.midi.demos.portsView.renderPorts = function (ports, sectionHeader, portMarkup) {
    fluid.each(ports, function (port) {
        flock.midi.demos.portsView.renderPort(port, sectionHeader, portMarkup);
    });
};
